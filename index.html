<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>mSafrain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- jQuery & jQuery UI -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css" />

  <!-- Desktop CSS -->
  <link rel="stylesheet" href="desktop.css" />

  <!-- Blogger feed loaders -->
  <script>
 function loadAllFeeds() {
  load_mThoughts_single();
  load_mThoughts_recent();
  load_mVisual();
  load_mObservation();
  load_mStratagems();
  load_mThoughts_archive();
  load_mVisual_archive();
  load_mObservation_archive();
  load_mStratagems_archive();
  load_mLetters(); // NEW
}

    /* mThoughts SINGLE (latest 1) */
    function load_mThoughts_single() {
      const url =
        "https://msafrain.blogspot.com/feeds/posts/default/-/mThoughts" +
        "?alt=json-in-script&max-results=1&callback=render_mThoughts_single";
      const script = document.createElement("script");
      script.src = url;
      document.body.appendChild(script);
    }

    function render_mThoughts_single(data) {
      const area = document.getElementById("mThoughtsSingle");
      if (!area) return;

      const entry = data.feed && data.feed.entry && data.feed.entry[0];
      if (!entry) {
        area.textContent = "No mThoughts yet.";
        return;
      }

      let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
      const temp = document.createElement("div");
      temp.innerHTML = contentHtml;
      temp.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(h => h.remove());

      let dateText = "";
      if (entry.published && entry.published.$t) {
        const published = new Date(entry.published.$t);
        if (!isNaN(published.getTime())) {
          dateText = published.toLocaleDateString("en-SG", {
            day: "2-digit",
            month: "short",
            year: "numeric"
          });
        }
      }

      const dateHTML = dateText
        ? `<div style="margin-top:12px; font-size:12px; color:#666;">${dateText}</div>`
        : "";

      area.innerHTML = `
        <div>${temp.innerHTML}</div>
        ${dateHTML}
      `;
    }

    /* mThoughts RECENT (latest 6) */
    function load_mThoughts_recent() {
      const url =
        "https://msafrain.blogspot.com/feeds/posts/default/-/mThoughts" +
        "?alt=json-in-script&max-results=6&callback=render_mThoughts_recent";
      const script = document.createElement("script");
      script.src = url;
      document.body.appendChild(script);
    }

    function render_mThoughts_recent(data) {
      const area = document.getElementById("mThoughtsRecent");
      if (!area) return;

      const entries = (data.feed && data.feed.entry) || [];
      if (!entries.length) {
        area.textContent = "No mThoughts yet.";
        return;
      }

      let output = "";
      entries.forEach(function (entry) {
        let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
        const temp = document.createElement("div");
        temp.innerHTML = contentHtml;
        temp.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(h => h.remove());

        let dateText = "";
        if (entry.published && entry.published.$t) {
          const published = new Date(entry.published.$t);
          if (!isNaN(published.getTime())) {
            dateText = published.toLocaleDateString("en-SG", {
              day: "2-digit",
              month: "short",
              year: "numeric"
            });
          }
        }

        const dateHTML = dateText
          ? `<div style="margin-top:8px; font-size:12px; color:#666;">${dateText}</div>`
          : "";

        output += `
          <article style="margin-bottom:24px;">
            <div>${temp.innerHTML}</div>
            ${dateHTML}
          </article>
        `;
      });

      area.innerHTML = output;
    }

    /* mVisual (images) */
    function load_mVisual() {
      const url =
        "https://msafrain.blogspot.com/feeds/posts/default/-/mVisual" +
        "?alt=json-in-script&max-results=6&callback=render_mVisual";
      const script = document.createElement("script");
      script.src = url;
      document.body.appendChild(script);
    }

    function render_mVisual(data) {
      const area = document.getElementById("mVisualContent");
      if (!area) return;

      const entries = (data.feed && data.feed.entry) || [];
      if (!entries.length) {
        area.textContent = "No visuals yet.";
        return;
      }

      let output = "";
      entries.forEach(function (entry) {
        let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
        const temp = document.createElement("div");
        temp.innerHTML = contentHtml;

        const imgs = temp.querySelectorAll("img");
        if (!imgs.length) return;

            imgs.forEach(function (img) {
      const meaning = img.getAttribute("alt") || "";  // take explanation from alt text

      output += `
        <div style="margin-bottom:20px;">
          <img 
            src="${img.src}"
            data-meaning="${meaning.replace(/"/g, '&quot;')}"
            style="width:100%; border-radius:8px; display:block; cursor:pointer;">
        </div>
      `;
    });
      });

      area.innerHTML = output || "No visuals yet.";
    }

    /* mObservation (latest 6) */
    function load_mObservation() {
      const url =
        "https://msafrain.blogspot.com/feeds/posts/default/-/mObservation" +
        "?alt=json-in-script&max-results=6&callback=render_mObservation";
      const script = document.createElement("script");
      script.src = url;
      document.body.appendChild(script);
    }

    function render_mObservation(data) {
      const area = document.getElementById("mObservationContent");
      if (!area) return;

      const entries = (data.feed && data.feed.entry) || [];
      if (!entries.length) {
        area.textContent = "No observations yet.";
        return;
      }

      let output = "";
      entries.forEach(function (entry) {
        let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
        const temp = document.createElement("div");
        temp.innerHTML = contentHtml;
        temp.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(h => h.remove());

        let dateText = "";
        if (entry.published && entry.published.$t) {
          const published = new Date(entry.published.$t);
          if (!isNaN(published.getTime())) {
            dateText = published.toLocaleDateString("en-SG", {
              day: "2-digit",
              month: "short",
              year: "numeric"
            });
          }
        }

        const dateHTML = dateText
          ? `<div style="margin-top:8px; font-size:12px; color:#666;">${dateText}</div>`
          : "";

        output += `
          <article style="margin-bottom:24px;">
            <div>${temp.innerHTML}</div>
            ${dateHTML}
          </article>
        `;
      });

      area.innerHTML = output;
    }

  /* mStratagems (latest 6) */
function load_mStratagems() {
  const url =
    "https://msafrain.blogspot.com/feeds/posts/default/-/mStratagems" +
    "?alt=json-in-script&max-results=6&callback=render_mStratagems";
  const script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}

function render_mStratagems(data) {
  const area = document.getElementById("mStratagemsContent");
  if (!area) return;

  const entries = (data.feed && data.feed.entry) || [];
  if (!entries.length) {
    area.textContent = "No mStratagems yet.";
    return;
  }

  let output = "";
  entries.forEach(function (entry) {
    let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
    const temp = document.createElement("div");
    temp.innerHTML = contentHtml;

    // remove Blogger headings
    temp.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(h => h.remove());

    // date
    let dateText = "";
    if (entry.published && entry.published.$t) {
      const published = new Date(entry.published.$t);
      if (!isNaN(published.getTime())) {
        dateText = published.toLocaleDateString("en-SG", {
          day: "2-digit",
          month: "short",
          year: "numeric"
        });
      }
    }

    const dateHTML = dateText
      ? `<div style="margin-top:8px; font-size:12px; color:#666;">${dateText}</div>`
      : "";

    output += `
      <article style="margin-bottom:24px;">
        <div>${temp.innerHTML}</div>
        ${dateHTML}
      </article>
    `;
  });

  area.innerHTML = output;
}

    /* mThoughts ARCHIVE (all posts) */
function load_mThoughts_archive() {
  const url =
    "https://msafrain.blogspot.com/feeds/posts/default/-/mThoughts" +
    "?alt=json-in-script&max-results=999&callback=render_mThoughts_archive";
  const script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}

function render_mThoughts_archive(data) {
  const area = document.getElementById("mThoughtsArchiveContent");
  if (!area) return;

  const entries = (data.feed && data.feed.entry) || [];
  if (!entries.length) {
    area.textContent = "No mThoughts yet.";
    return;
  }

  let output = "";
  entries.forEach(function (entry) {
    let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
    const temp = document.createElement("div");
    temp.innerHTML = contentHtml;
    temp.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(h => h.remove());

    let dateText = "";
    if (entry.published && entry.published.$t) {
      const published = new Date(entry.published.$t);
      if (!isNaN(published.getTime())) {
        dateText = published.toLocaleDateString("en-SG", {
          day: "2-digit",
          month: "short",
          year: "numeric"
        });
      }
    }

    const dateHTML = dateText
      ? `<div style="margin-top:8px; font-size:12px; color:#666;">${dateText}</div>`
      : "";

    output += `
      <article style="margin-bottom:24px;">
        <div>${temp.innerHTML}</div>
        ${dateHTML}
      </article>
    `;
  });

  area.innerHTML = output;
}

/* mVisual ARCHIVE (all posts) */
function load_mVisual_archive() {
  const url =
    "https://msafrain.blogspot.com/feeds/posts/default/-/mVisual" +
    "?alt=json-in-script&max-results=999&callback=render_mVisual_archive";
  const script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}

function render_mVisual_archive(data) {
  const area = document.getElementById("mVisualArchiveContent");
  if (!area) return;

  const entries = (data.feed && data.feed.entry) || [];
  if (!entries.length) {
    area.textContent = "No mVisual posts yet.";
    return;
  }

  let output = "";
  entries.forEach(function (entry) {
    let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
    const temp = document.createElement("div");
    temp.innerHTML = contentHtml;

    const imgs = temp.querySelectorAll("img");
    if (!imgs.length) return;

    imgs.forEach(function (img) {
      const meaning = img.getAttribute("alt") || "";
      output += `
        <div style="margin-bottom:20px;">
          <img 
            src="${img.src}"
            data-meaning="${meaning.replace(/"/g, '&quot;')}"
            style="width:100%; border-radius:8px; display:block; cursor:pointer;">
        </div>
      `;
    });
  });

  area.innerHTML = output || "No visuals yet.";
}

/* mObservation ARCHIVE (all posts) */
function load_mObservation_archive() {
  const url =
    "https://msafrain.blogspot.com/feeds/posts/default/-/mObservation" +
    "?alt=json-in-script&max-results=999&callback=render_mObservation_archive";
  const script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}

function render_mObservation_archive(data) {
  const area = document.getElementById("mObservationArchiveContent");
  if (!area) return;

  const entries = (data.feed && data.feed.entry) || [];
  if (!entries.length) {
    area.textContent = "No observations yet.";
    return;
  }

  let output = "";
  entries.forEach(function (entry) {
    let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
    const temp = document.createElement("div");
    temp.innerHTML = contentHtml;
    temp.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(h => h.remove());

    let dateText = "";
    if (entry.published && entry.published.$t) {
      const published = new Date(entry.published.$t);
      if (!isNaN(published.getTime())) {
        dateText = published.toLocaleDateString("en-SG", {
          day: "2-digit",
          month: "short",
          year: "numeric"
        });
      }
    }

    const dateHTML = dateText
      ? `<div style="margin-top:8px; font-size:12px; color:#666;">${dateText}</div>`
      : "";

    output += `
      <article style="margin-bottom:24px;">
        <div>${temp.innerHTML}</div>
        ${dateHTML}
      </article>
    `;
  });

  area.innerHTML = output;
}

/* mStratagems ARCHIVE (all posts) */
function load_mStratagems_archive() {
  const url =
    "https://msafrain.blogspot.com/feeds/posts/default/-/mStratagems" +
    "?alt=json-in-script&max-results=999&callback=render_mStratagems_archive";
  const script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}

function render_mStratagems_archive(data) {
  const area = document.getElementById("mStratagemsArchiveContent");
  if (!area) return;

  const entries = (data.feed && data.feed.entry) || [];
  if (!entries.length) {
    area.textContent = "No mStratagems yet.";
    return;
  }

  let output = "";
  entries.forEach(function (entry) {
    let contentHtml = entry.content && entry.content.$t ? entry.content.$t : "";
    const temp = document.createElement("div");
    temp.innerHTML = contentHtml;

    temp.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(h => h.remove());

    let dateText = "";
    if (entry.published && entry.published.$t) {
      const published = new Date(entry.published.$t);
      if (!isNaN(published.getTime())) {
        dateText = published.toLocaleDateString("en-SG", {
          day: "2-digit",
          month: "short",
          year: "numeric"
        });
      }
    }

    const dateHTML = dateText
      ? `<div style="margin-top:8px; font-size:12px; color:#666;">${dateText}</div>`
      : "";

    output += `
      <article style="margin-bottom:24px;">
        <div>${temp.innerHTML}</div>
        ${dateHTML}
      </article>
    `;
  });

  area.innerHTML = output;
}

/* mLetters (latest 6 from label mLetters) */
function load_mLetters() {
  const url =
    "https://msafrain.blogspot.com/feeds/posts/default/-/mLetters" +
    "?alt=json-in-script&max-results=6&callback=render_mLetters";

  const script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}

function render_mLetters(data) {
  const listEl = document.getElementById("mLettersList");
  const badgeEl = document.getElementById("envelope-badge");
  if (!listEl) return;

  const entries = (data.feed && data.feed.entry) || [];
  listEl.innerHTML = ""; // clear hardcoded items

  if (!entries.length) {
    listEl.innerHTML = "<li>No letters yet.</li>";
    if (badgeEl) badgeEl.textContent = "0";
    return;
  }

  entries.forEach(function (entry) {
    const title = entry.title && entry.title.$t ? entry.title.$t : "Untitled letter";

    let dateText = "";
    if (entry.published && entry.published.$t) {
      const published = new Date(entry.published.$t);
      if (!isNaN(published.getTime())) {
        dateText = published.toLocaleDateString("en-SG", {
          day: "2-digit",
          month: "short",
          year: "numeric"
        });
      }
    }

    // build a list item
    const li = document.createElement("li");
    li.style.marginBottom = "8px";

    li.innerHTML = `
      <div style="font-size:11px;opacity:0.7;">${dateText}</div>
      <div style="font-size:13px;">${title}</div>
    `;

    listEl.appendChild(li);
  });

  // Update badge with number of letters (capped at 9+ if you want)
  if (badgeEl) {
    const count = entries.length;
    badgeEl.textContent = count > 9 ? "9+" : String(count);
  }
}
  </script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D2X3W8CYNC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-D2X3W8CYNC');

  // ðŸ”½ Simplified Visual Meaning handler
  document.addEventListener("click", function (e) {
    const img = e.target.closest("img[data-meaning]");
    if (!img) return;

    const meaning = img.getAttribute("data-meaning") || "No explanation yet.";

    // Put the meaning text into the Visual Meaning window
    const contentEl = document.getElementById("visualMeaningContent");
    if (contentEl) {
      contentEl.textContent = meaning;
    }

    // Use the existing window system via hidden button
    const btn = document.querySelector(
      'button.openWindow[data-window-id="visual-meaning"]'
    );
    if (btn) {
      btn.click();  // uses your normal openWindow logic (z-index, taskbar, scroll, etc.)
    }
  });

  // ðŸ”½ Archive list click handler (inside mArchives window)
  document.addEventListener("click", function (e) {
    const item = e.target.closest(".archive-item");
    if (!item) return;

    const targetKey = item.getAttribute("data-window-id");
    if (!targetKey) return;

    const btn = document.querySelector(
      'button.openWindow[data-window-id="' + targetKey + '"]'
    );
    if (btn) {
      btn.click();
    }
  });
</script>
</head>
<body onload="loadAllFeeds()">

  <div id="mSafrain">

    <!-- TOP LAUNCHBAR (uses data-window-id, not numbers) -->
 <div class="openWindowButtons">
  <button class="openWindow" data-window-id="by-main">By mSafrain</button>
  <button class="openWindow" data-window-id="mthoughts-recent">mThoughts</button>
  <button class="openWindow" data-window-id="mvisual">mVisual</button>
  <button class="openWindow" data-window-id="mobservation">mObservation</button>
  <button class="openWindow" data-window-id="mstratagems">mStratagems</button>
  <button class="openWindow" data-window-id="marchives">mArchives</button>

    <!-- HIDDEN buttons for archives -->
  <button class="openWindow" data-window-id="mthoughts-archive" style="display:none;"></button>
  <button class="openWindow" data-window-id="mvisual-archive" style="display:none;"></button>
  <button class="openWindow" data-window-id="mobservation-archive" style="display:none;"></button>
  <button class="openWindow" data-window-id="mstratagems-archive" style="display:none;"></button>

  <!-- NEW: hidden launcher for mLetters / mEnvelope -->
  <button class="openWindow" data-window-id="menvelope" style="display:none;"></button>

  <!-- ðŸ”½ NEW: hidden launcher for Visual Meaning -->
  <button class="openWindow" data-window-id="visual-meaning" style="display:none;"></button>
</div>

    <!-- Window: 0 â€“ By mSafrain -->
    <div class="window"
         data-window-id="by-main"
         data-title="By mSafrain"
         style="top:80px;left:40px;">
      <p>Here lie the windows of my thoughts...</p>
      <p>
        You may read my books on
        <a href="https://www.wattpad.com/user/msafrain" target="_blank">Wattpad</a>.
      </p>
    </div>

    <!-- Window: 1 â€“ mThoughts SINGLE -->
    <div class="window"
         data-window-id="mthoughts-single"
         data-title="mThoughts"
         style="top:80px;left:520px;height:300px;">
      <div class="poetry-area" id="mThoughtsSingle">
        Loading mThoughts...
      </div>
    </div>

    <!-- Window: 2 â€“ mThoughts RECENT -->
    <div class="window closed"
         data-window-id="mthoughts-recent"
         data-title="mThoughts â€“ Recent"
         style="top:260px;left:220px;height:600px;">
      <div class="poetry-area" id="mThoughtsRecent">
        Loading recent mThoughts...
      </div>
    </div>

    <!-- Window: 3 â€“ mVisual -->
    <div class="window closed"
         data-window-id="mvisual"
         data-title="mVisual"
         style="top:120px;left:60px;height:600px;">
      <div class="poetry-area" id="mVisualContent">
        Loading mVisual...
      </div>
    </div>

    <!-- Window: Visual Meaning -->
    <div class="window closed"
         data-window-id="visual-meaning"
         data-title="Visual Meaning"
         style="top:220px;left:360px;width:420px;height:260px;">
      <div class="poetry-area" id="visualMeaningContent">
        Click a visual to see its meaning.
      </div>
    </div>


    <!-- Window: 4 â€“ mObservation -->
    <div class="window closed"
         data-window-id="mobservation"
         data-title="mObservation"
         style="top:150px;left:680px;height:600px;">
      <div class="poetry-area" id="mObservationContent">
        Loading mObservation...
      </div>
    </div>

    <!-- Window: 5 â€“ mStratagems -->
<div class="window closed"
     data-window-id="mstratagems"
     data-title="mStratagems"
     style="top:220px;left:360px;height:600px;">
  <div class="poetry-area" id="mStratagemsContent">
    Loading mStratagems...
  </div>
</div>

    <!-- Window: mThoughts Archives -->
<div class="window closed"
     data-window-id="mthoughts-archive"
     data-title="mThoughts Archives"
     style="top:200px;left:80px;height:600px;">
  <div class="poetry-area" id="mThoughtsArchiveContent">
    Loading mThoughts Archives...
  </div>
</div>

<!-- Window: mVisual Archives -->
<div class="window closed"
     data-window-id="mvisual-archive"
     data-title="mVisual Archives"
     style="top:200px;left:520px;height:600px;">
  <div class="poetry-area" id="mVisualArchiveContent">
    Loading mVisual Archives...
  </div>
</div>

<!-- Window: mObservation Archives -->
<div class="window closed"
     data-window-id="mobservation-archive"
     data-title="mObservation Archives"
     style="top:220px;left:160px;height:600px;">
  <div class="poetry-area" id="mObservationArchiveContent">
    Loading mObservation Archives...
  </div>
</div>

<!-- Window: mStratagems Archives -->
<div class="window closed"
     data-window-id="mstratagems-archive"
     data-title="mStratagems Archives"
     style="top:220px;left:600px;height:600px;">
  <div class="poetry-area" id="mStratagemsArchiveContent">
    Loading mStratagems Archives...
  </div>
</div>

<!-- Window: mArchives -->
<div class="window closed"
     data-window-id="marchives"
     data-title="mArchives"
     style="top:180px;left:280px;width:380px;height:320px;">
   <div class="poetry-area">
    <div class="archive-item" data-window-id="mthoughts-archive">mThoughts Archives</div>
    <div class="archive-item" data-window-id="mvisual-archive">mVisual Archives</div>
    <div class="archive-item" data-window-id="mobservation-archive">mObservation Archives</div>
    <div class="archive-item" data-window-id="mstratagems-archive">mStratagems Archives</div>
    <div class="archive-item" data-window-id="menvelope">mLetters</div> <!-- â† add this -->
  </div>
</div>

 <!-- mEnvelope Desktop Icon -->
<div class="desktop-icon m-envelope" data-window-id="menvelope">
  <div class="icon-envelope"></div>
  <span class="icon-label">mEnvelope</span>
  <span class="icon-badge" id="envelope-badge">6</span>
</div>

    <!-- Window: mEnvelope / mLetters -->
<div class="window closed"
     data-window-id="menvelope"
     data-title="mLetters"
     style="top:200px;left:520px;width:420px;height:320px;">
  <div class="poetry-area">
    <p style="margin-bottom:8px; font-size:13px; opacity:0.8;">
      Latest letters (max 6 shown)
    </p>

    <!-- ðŸ”½ ADD THIS BLOCK BACK -->
    <ul id="mLettersList"
        style="list-style:none;margin:0;padding:0;max-height:220px;overflow-y:auto;">
      <!-- will be auto-filled by render_mLetters -->
    </ul>
    <!-- ðŸ”¼ ADD THIS BLOCK BACK -->

    <p style="margin-top:6px;font-size:11px;opacity:0.75;">
      View all mLetters inside mArchives.
    </p>
  </div>
</div>

    <!-- TASKBAR -->
    <div id="taskbar"></div>
  </div>

  <!-- Desktop window logic -->
  <script src="desktop.js"></script>
</body>
</html>
