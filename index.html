<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>mSafrain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- jQuery & jQuery UI (for dragging/resizing windows) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css" />

  <!-- Our CSS -->
  <link rel="stylesheet" href="desktop.css" />

  <!-- Blogger JSONP loader -->
  <!-- Blogger JSONP loader for latest 3 posts -->
<script>
function loadBlogspot() {
  const url = "https://msafrain.blogspot.com/feeds/posts/default?alt=json-in-script&max-results=3&callback=showThreePosts";
  const script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}

function showThreePosts(data) {
  const area = document.getElementById("poetryContent");
  if (!area) return;

  try {
    const entries = data.feed.entry;
    if (!entries || entries.length === 0) {
      area.textContent = "No recent posts.";
      return;
    }

    let html = "";

    entries.forEach((entry, i) => {
      let title = entry.title?.$t || "Untitled";

      let published = entry.published?.$t;
      let dateText = "";
      if (published) {
        try {
          let date = new Date(published);
          dateText = date.toLocaleDateString("en-SG", {
            day: "2-digit",
            month: "short",
            year: "numeric",
          });
        } catch (e) {
          dateText = published;
        }
      }

      let body = entry.content?.$t || entry.summary?.$t || "";

      html += `
        <div class="thought-section">
          <div class="thought-title" style="font-weight:600; font-size:16px;">${title}</div>
          <div class="thought-date" style="font-size:12px; color:#666;">${dateText}</div>
          <div class="thought-body" style="margin-top:8px;">${body}</div>
        </div>
      `;

      if (i < entries.length - 1) {
        html += `<hr style="border:none; border-top:1px solid #ddd; margin:16px 0;" />`;
      }
    });

    area.innerHTML = html;
  } catch (e) {
    console.error(e);
    area.textContent = "Unable to load mThoughts.";
  }
}
</script>
</head>

<body onload="loadBlogspot()">

  <div id="mSafrain">

    <!-- QUICK LAUNCH BUTTONS -->
    <div class="openWindowButtons">
      <button class="openWindow" data-id="0">By M Safrain</button>
      <button class="openWindow" data-id="1">mThoughts</button>
    </div>

    <!-- Window 0 -->
    <div class="window" data-title="By M Safrain" style="top: 60px; left: 60px;">
      <p>Here, I write my thoughts...</p>
      <p>
        You may read mPoetry on
        <a href="https://www.wattpad.com/user/msafrain" target="_blank">Wattpad</a>.
      </p>
    </div>

    <!-- Window 1: mThoughts -->
    <div class="window" data-title="mThoughts" style="top: 140px; left: 520px; height: 600px;">
      <div class="poetry-area" id="poetryContent">
        Loading latest piece...
      </div>
    </div>

    <!-- Hidden window example -->
    <div class="window closed" data-title="About" style="top: 180px; left: 220px;">
      <h2>About</h2>
      <p>This UI is fully custom built. Draggable, resizable, clean, lightweight. Designed for M. Safrain.</p>
    </div>

    <!-- TASKBAR -->
    <div id="taskbar"></div>
  </div>

  <!-- Window logic -->
  <script src="desktop.js"></script>
</body>
</html>
