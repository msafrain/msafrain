<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>mSafrain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- jQuery & jQuery UI (for dragging/resizing windows) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css" />

  <!-- Your desktop CSS -->
  <link rel="stylesheet" href="desktop.css" />

  <!-- Blogger JSONP loader: 6 posts, used by both windows -->
  <script>
    function loadBlogspot() {
      const url =
        "https://msafrain.blogspot.com/feeds/posts/default" +
        "?alt=json-in-script&max-results=6&callback=handleBlogFeed";
      const script = document.createElement("script");
      script.src = url;
      document.body.appendChild(script);
    }

    // Main callback for JSONP
    function handleBlogFeed(data) {
      renderLatestSingle(data);  // for mThoughts window (1 post)
      renderRecentList(data);    // for the extra window (6 posts)
    }

    function renderLatestSingle(data) {
      const area = document.getElementById("poetryContent");
      if (!area) return;

      try {
        const entry = data.feed.entry && data.feed.entry[0];
        if (!entry) {
          area.textContent = "No entries published yet.";
          return;
        }

        let contentHtml =
          entry.content && entry.content.$t
            ? entry.content.$t.trim()
            : "";

        const temp = document.createElement("div");
        temp.innerHTML = contentHtml;

        // Remove all headings (hide Blogger title inside content)
        const headings = temp.querySelectorAll("h1,h2,h3,h4,h5,h6");
        headings.forEach(h => h.remove());

        // Date
        let published =
          entry.published && entry.published.$t
            ? new Date(entry.published.$t)
            : null;

        let dateText = "";
        if (published && !isNaN(published.getTime())) {
          dateText = published.toLocaleDateString("en-SG", {
            day: "2-digit",
            month: "short",
            year: "numeric"
          });
        }

        const cleanedContent = temp.innerHTML.trim();
        const dateHTML = dateText
          ? `<div style="margin-top:16px; color:#666; font-size:12px;">${dateText}</div>`
          : "";

        area.innerHTML = `
          <div>${cleanedContent}</div>
          ${dateHTML}
        `;
      } catch (e) {
        console.error(e);
        area.textContent = "Unable to load mThoughts.";
      }
    }

    function renderRecentList(data) {
      const area = document.getElementById("recentContent");
      if (!area) return;

      try {
        const entries = (data.feed && data.feed.entry) || [];
        if (!entries.length) {
          area.textContent = "No entries published yet.";
          return;
        }

        let allPostsHTML = "";

        // List up to 6 posts
        entries.slice(0, 6).forEach(function(entry) {
          let contentHtml =
            entry.content && entry.content.$t
              ? entry.content.$t.trim()
              : "";

          const temp = document.createElement("div");
          temp.innerHTML = contentHtml;

          // Remove headings again
          const headings = temp.querySelectorAll("h1,h2,h3,h4,h5,h6");
          headings.forEach(h => h.remove());

          // Date
          let published =
            entry.published && entry.published.$t
              ? new Date(entry.published.$t)
              : null;

          let dateText = "";
          if (published && !isNaN(published.getTime())) {
            dateText = published.toLocaleDateString("en-SG", {
              day: "2-digit",
              month: "short",
              year: "numeric"
            });
          }

          const cleanedContent = temp.innerHTML.trim();
          const dateHTML = dateText
            ? `<div style="margin-top:8px; color:#666; font-size:12px;">${dateText}</div>`
            : "";

          allPostsHTML += `
            <article style="margin-bottom:24px;">
              <div>${cleanedContent}</div>
              ${dateHTML}
            </article>
          `;
        });

        area.innerHTML = allPostsHTML;
      } catch (e) {
        console.error(e);
        area.textContent = "Unable to load recent mThoughts.";
      }
    }
  </script>
</head>

<body onload="loadBlogspot()">
  <div id="mSafrain">
    <!-- QUICK LAUNCH BUTTONS -->
<div class="openWindowButtons">
  <button class="openWindow" data-window-target="by-msafrain">By mSafrain</button>
  <!-- This quick launch opens the 6-post window -->
  <button class="openWindow" data-window-target="mthoughts-recent">mThoughts</button>
</div>

<!-- Window 0: By mSafrain -->
<div class="window" data-window-id="by-msafrain" data-title="By mSafrain" style="top: 60px; left: 60px;">
  <p>Here, I write my thoughts...</p>
  <p>
    You may read mPoetry on
    <a href="https://www.wattpad.com/user/msafrain" target="_blank">Wattpad</a>.
  </p>
</div>

<!-- Window 1: mThoughts (single latest post, visible on desktop) -->
<div class="window" data-window-id="mthoughts-single" data-title="mThoughts" style="top: 140px; left: 520px; height: 600px;">
  <div class="poetry-area" id="poetryContent">
    Loading latest piece...
  </div>
</div>

<!-- Window 2: mThoughts – Recent (6 posts, opened by launchbar) -->
<div class="window closed" data-window-id="mthoughts-recent" data-title="mThoughts – Recent" style="top: 200px; left: 180px; height: 600px; width: 520px;">
  <div class="poetry-area" id="recentContent">
    Loading recent pieces...
  </div>
</div>

<!-- Hidden window example -->
<div class="window closed" data-window-id="about" data-title="About" style="top: 180px; left: 220px;">
  <h2>About</h2>
  <p>This UI is fully custom built. Draggable, resizable, clean, lightweight. Designed for M. Safrain.</p>
</div>
    <!-- TASKBAR -->
    <div id="taskbar"></div>
  </div>

  <!-- Window logic (your existing JS) -->
  <script src="desktop.js"></script>
</body>
</html>
