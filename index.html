<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>mSafrain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- jQuery & jQuery UI (for dragging/resizing windows) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css" />

  <!-- Our CSS -->
  <link rel="stylesheet" href="desktop.css" />

  <!-- Blogger JSONP loader -->
  <script>
  // Load Blogger feed using JSONP
  function loadBlogspot() {
    const url = "https://msafrain.blogspot.com/feeds/posts/default?alt=json-in-script&callback=showPostClean";
    const script = document.createElement("script");
    script.src = url;
    document.body.appendChild(script);
  }

  function showPostClean(data) {
    const area = document.getElementById("poetryContent");
    if (!area) return;

    try {
      const entry = data.feed.entry[0];

      // Raw HTML from Blogger
      let contentHtml =
        (entry.content && entry.content.$t ? entry.content.$t : "").trim();

      // Parse to DOM
      const temp = document.createElement("div");
      temp.innerHTML = contentHtml;

      // 1) Remove any headings that are exactly "Untitled"
      const headings = temp.querySelectorAll("h1,h2,h3,h4,h5,h6");
      headings.forEach(function (h) {
        if (h.textContent.trim().toLowerCase() === "untitled") {
          h.remove();
        }
      });

      // 2) Compute date text from feed
      let published = entry.published && entry.published.$t
        ? new Date(entry.published.$t)
        : null;

      let dateText = "";
      if (published) {
        dateText = published.toLocaleDateString("en-SG", {
          day: "2-digit",
          month: "short",
          year: "numeric"
        });
      }

      // 3) Remove any element whose whole text is exactly the date (to kill your manual top date)
      if (dateText) {
        const allEls = temp.querySelectorAll("*");
        allEls.forEach(function (el) {
          if (el.childNodes.length === 1 &&
              el.textContent.trim() === dateText) {
            el.remove();
          }
        });
      }

      const cleanedContent = temp.innerHTML.trim();

      const dateHTML = dateText
        ? `<div style="color:#666; font-size:13px; margin-top:12px;">${dateText}</div>`
        : "";

      // Content first, date at the bottom
      area.innerHTML = `
        <div>${cleanedContent}</div>
        ${dateHTML}
      `;
    } catch (e) {
      console.error(e);
      area.textContent = "Unable to load mThoughts.";
    }
  }
</script>
</head>

<body onload="loadBlogspot()">

  <div id="mSafrain">

    <!-- QUICK LAUNCH BUTTONS -->
    <div class="openWindowButtons">
      <button class="openWindow" data-id="0">By M Safrain</button>
      <button class="openWindow" data-id="1">mThoughts</button>
    </div>

    <!-- Window 0 -->
    <div class="window" data-title="By M Safrain" style="top: 60px; left: 60px;">
      <p>Here, I write my thoughts...</p>
      <p>
        You may read mPoetry on
        <a href="https://www.wattpad.com/user/msafrain" target="_blank">Wattpad</a>.
      </p>
    </div>

    <!-- Window 1: mThoughts -->
    <div class="window" data-title="mThoughts" style="top: 140px; left: 520px; height: 600px;">
      <div class="poetry-area" id="poetryContent">
        Loading latest piece...
      </div>
    </div>

    <!-- Hidden window example -->
    <div class="window closed" data-title="About" style="top: 180px; left: 220px;">
      <h2>About</h2>
      <p>This UI is fully custom built. Draggable, resizable, clean, lightweight. Designed for M. Safrain.</p>
    </div>

    <!-- TASKBAR -->
    <div id="taskbar"></div>
  </div>

  <!-- Window logic -->
  <script src="desktop.js"></script>
</body>
</html>
